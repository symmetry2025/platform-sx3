# Backlog: Арифметика (2 класс) — Сложение и вычитание

Дата: 2026-02-06  
Область: `projects/symmetry-trainer/trainer-wt/_main`  
Цель: обогатить продукт **новыми тренажёрами** по сложению/вычитанию для 2 класса и навести порядок в **раскладке/порядке** и **привязке к классу**.

## 1) Как сейчас устроена система (точки встраивания)

- **Каталог/порядок упражнений на странице** задаётся в `src/data/exerciseData.ts` в структуре `GradeSection[]` (grade → sections → exercises).
- **Устный счёт (drill-формат a±b=?)** задаётся в `src/data/mentalMathConfig.ts` как `MENTAL_MATH_CONFIGS[exerciseId]`:
  - `generator(): {a,b,answer}`
  - `problemType: 'addition'|'subtraction'`
  - уровни пайплайна (presets) берутся из `MentalMathDefinition` (точность выбор/ввод, скорость, гонка ⭐1–3).
- **Маршрутизация**: любая запись, присутствующая в `MENTAL_MATH_CONFIGS`, автоматически запускается как `/addition/<exerciseId>` через `TrainerFlow` (`src/app/(app)/addition/[exerciseId]/page.tsx`).

## 2) Важная развилка по типам задач

Новые тренажёры делятся на два типа:

1) **Обычные примеры**: `a + b = ?` и `a − b = ?`  
   Реализация: просто добавляем новые `exerciseId` в `MENTAL_MATH_CONFIGS` + новые генераторы.

2) **“Неизвестный компонент” (уравнения с пропуском)**:  
   - `? + b = sum` (неизвестное слагаемое)  
   - `a + ? = sum` (неизвестное слагаемое, вариант)  
   - `? − b = diff` (неизвестное уменьшаемое)  
   - `a − ? = diff` (неизвестное вычитаемое)

   Это **не укладывается** в текущий `MentalMathGame`, который рисует строго `a op b =`.
   Нужно добавить отдельную реализацию сессии (внутри того же каноничного пайплайна `TrainerFlow`):
   - новый “arithmetic equation” drill-session поверх `useDrillEngine<TProblem>`
   - отображение выражения с “окошком” `?` и вводом ответа (choice/manual)
   - `answerOf(problem)` = значение неизвестного

## 3) Каноничный нейминг `exerciseId` (предложение)

Принцип: коротко, машинно-читабельно, без “runner/mental-math”.

- Сложение:
  - `add-10` (уже есть)
  - `add-20-no-carry` — в пределах 20 **без** перехода через десяток
  - `add-20-carry` — в пределах 20 **с** переходом через десяток
  - `add-to-round-ten` — “к круглому десятку” (8+2, 36+4, 58+2)
  - `add-2d-1d-no-carry` — двузначное + однозначное без перехода
  - `add-2d-1d-carry` — двузначное + однозначное с переходом
  - `add-2d-2d-no-carry` — двузначное + двузначное без перехода
  - `add-2d-2d-carry` — двузначное + двузначное с переходом
  - `add-zero` — сложение с нулём

- Неизвестное слагаемое:
  - `add-missing-addend-10`
  - `add-missing-addend-20`
  - `add-missing-addend-50`

- Вычитание:
  - `sub-10` (уже есть)
  - `sub-to-round-ten` — “до круглого десятка” и “от круглого десятка”
  - `sub-20-2d-1d-no-borrow` — двузначное−однозначное (в пределах 20) без перехода
  - `sub-20-2d-1d-borrow` — двузначное−однозначное (в пределах 20) с переходом
  - `sub-2d-2d-round` — двузначное−двузначное “круглое” (десятки)
  - `sub-2d-2d-no-borrow` — двузначное−двузначное без перехода
  - `sub-2d-2d-borrow` — двузначное−двузначное с переходом

- Неизвестное уменьшаемое/вычитаемое:
  - `sub-missing-minuend-10`, `sub-missing-subtrahend-10`
  - `sub-missing-minuend-20`, `sub-missing-subtrahend-20`
  - `sub-missing-minuend-50`, `sub-missing-subtrahend-50`
  - `sub-missing-minuend-100`, `sub-missing-subtrahend-100`

Примечание: в исходном списке “неизвестное … в пределах 100” повторяется два раза — трактуем как **1 пункт** (две разновидности: неизвестное уменьшаемое и неизвестное вычитаемое).

Также прямо сейчас в коде уже есть рабочие устные тренажёры `add-20` и `sub-20`, которые фактически соответствуют варианту **“с переходом через десяток”**.
До момента внедрения новых `exerciseId` мы используем временный mapping:
- `add-20` = `add-20-carry` (в пределах 20 с переходом)
- `sub-20` = `sub-20-borrow` (в пределах 20 с переходом)

## 4) Порядок упражнений в 2 классе (предложение)

Секция “Сложение” (grade=2):
1. `add-10`
2. `add-missing-addend-10`
3. `add-20-no-carry`
4. `add-20-carry`
5. `add-missing-addend-20`
6. `add-to-round-ten`
7. `add-2d-1d-no-carry`
8. `add-2d-1d-carry`
9. `add-2d-2d-no-carry`
10. `add-2d-2d-carry`
11. `add-missing-addend-50`
12. `add-zero`

Секция “Вычитание” (grade=2):
1. `sub-10`
2. `sub-missing-minuend-10` (или объединённый тренажёр “неизвестный компонент −10”, см. ниже)
3. `sub-missing-subtrahend-10`
4. `sub-to-round-ten`
5. `sub-20-2d-1d-no-borrow`
6. `sub-20-2d-1d-borrow`
7. `sub-missing-minuend-20`
8. `sub-missing-subtrahend-20`
9. `sub-2d-2d-round`
10. `sub-2d-2d-no-borrow`
11. `sub-missing-minuend-50`
12. `sub-2d-2d-borrow`
13. `sub-missing-subtrahend-50`
14. `sub-missing-minuend-100`
15. `sub-missing-subtrahend-100`

## 5) Backlog issues (по тренажёрам)

Нотация:
- **Type A (mental)**: обычные примеры `a±b=?` → добавляем в `MENTAL_MATH_CONFIGS`
- **Type B (equation)**: неизвестный компонент `?±b=c`/`a±?=c` → нужен новый session (см. “Epic EQU”)

### Epic CAT-2 — Каталог 2 класса: порядок и секции

**CAT-2.001 — Обновить каталог 2 класса (addition/subtraction)**
- **Цель**: привести `src/data/exerciseData.ts` к новому набору упражнений для 2 класса и каноничному порядку из раздела 4.
- **Acceptance**:
  - на `/addition` в 2 классе отображаются все новые упражнения
  - порядок соответствует утверждённому списку
  - новые `exerciseId` имеют человеко-понятные `title`/`description`

---

### Epic ADD-A — Сложение: обычные примеры (Type A)

**ADD-A.001 — `add-20-no-carry`**
- **Описание**: сложение в пределах 20 **без** перехода через десяток (пример: 13+4).
- **Генератор**:
  - цель: \(a+b \le 20\)
  - условие “без перехода”: \((a \bmod 10) + b < 10\)
  - диапазоны: `a` 10..19, `b` 1..9 (или симметрично), исключить `b=0`.
- **Проверка**: 1000 генераций → ни одного carry, сумма ≤20.

**ADD-A.002 — `add-20-carry`**
- **Описание**: сложение в пределах 20 **с** переходом через десяток.
- **Генератор**:
  - \(a+b \le 20\)
  - carry: \((a \bmod 10) + b \ge 10\)
  - диапазоны: `a` 10..19, `b` 1..9, плюс можно поддержать 1-значные `a` 2..9 (как текущий `add-20`).
- **Проверка**: 1000 генераций → всегда carry, сумма ≤20.

**ADD-A.003 — `add-to-round-ten`**
- **Описание**: сложение “к круглому десятку”: 8+2, 36+4, 58+2.
- **Генератор**:
  - случайно выбрать `a` из {1..9} ∪ {10..99 с единицами 1..9}
  - `b = 10 - (a % 10)` (для a<10: b = 10-a)
  - результат кратен 10.
- **Проверка**: всегда оканчивается на 0.

**ADD-A.004 — `add-2d-1d-no-carry`**
- **Описание**: двузначное + однозначное без перехода.
- **Генератор**:
  - `a` 10..99, `b` 1..9
  - \((a \bmod 10)+b < 10\)
  - результат ≤ 99 (или ≤100 по договорённости; фиксируем в реализации).

**ADD-A.005 — `add-2d-1d-carry`**
- **Описание**: двузначное + однозначное с переходом.
- **Генератор**:
  - `a` 10..99, `b` 1..9
  - \((a \bmod 10)+b \ge 10\)
  - ограничить результат ≤ 100 (чтобы оставаться в 2 классе).

**ADD-A.006 — `add-2d-2d-no-carry`**
- **Описание**: двузначное + двузначное без перехода (пример: 23+14).
- **Генератор**:
  - `a` 10..99, `b` 10..99
  - единицы без carry: \((a%10)+(b%10) < 10\)
  - десятки без переполнения: \(\lfloor a/10\rfloor + \lfloor b/10\rfloor \le 9\)
  - результат ≤ 99/100 (фиксируем).

**ADD-A.007 — `add-2d-2d-carry`**
- **Описание**: двузначное + двузначное с переходом (пример: 27+18).
- **Генератор**:
  - carry по единицам: \((a%10)+(b%10) \ge 10\)
  - результат ≤ 100.

**ADD-A.008 — `add-zero`**
- **Описание**: сложение с нулём (45+0, 0+9).
- **Генератор**:
  - с вероятностью 50%: `a` 0..99, `b=0`
  - иначе: `a=0`, `b` 0..99
  - исключить “0+0” если считаем слишком тривиальным (решение фиксируем).

---

### Epic ADD-EQU — Сложение: неизвестное слагаемое (Type B)

**EQU.001 — Добавить новый “Equation drill” session**
- **Цель**: поддержать задания с пропуском `?` в каноничном пайплайне.
- **Подход**:
  - новый тип problem, например:
    - `{ kind:'add-missing', known:number, sum:number, unknownPosition:'left'|'right', answer:number }`
  - новый session component (например `ArithmeticEquationSession`) на `useDrillEngine`
  - рендер карточки: `? + 7 = 13` или `6 + ? = 13`
  - ввод: choice/manual (как в mental)
- **Acceptance**:
  - работает с `TrainerFlow` + `TrainerGameFrame` (embedded chrome)
  - правильность/ошибки/таймер работают через метрики

**ADD-EQU.001 — `add-missing-addend-10`**
- **Описание**: неизвестное слагаемое в пределах 10 (по другому слагаемому и сумме).
- **Генератор**:
  - выбрать `sum` 2..10, `known` 1..(sum-1)
  - `answer = sum-known`
  - позиция неизвестного: сначала только слева `?+known=sum`, затем (опционально) смешивать.

**ADD-EQU.002 — `add-missing-addend-20`**
- **Описание**: неизвестное слагаемое в пределах 20.
- **Генератор**: аналогично, `sum` 2..20.

**ADD-EQU.003 — `add-missing-addend-50`**
- **Описание**: неизвестное слагаемое в пределах 50.
- **Генератор**: `sum` 2..50, `known` 0..sum (исключить тривиальные крайние случаи по договорённости).

---

### Epic SUB-A — Вычитание: обычные примеры (Type A)

**SUB-A.001 — `sub-to-round-ten`**
- **Описание**: “до круглого десятка” (14−4, 62−2) и “от круглого десятка” (70−6).
- **Генератор** (смешанный):
  - случай 1 (до круглого): `a` 11..99, `b=a%10` (b 1..9), ответ кратен 10
  - случай 2 (от круглого): `a` 10,20,...,90, `b` 1..9
- **Проверка**: ответы корректны, отрицательных нет.

**SUB-A.002 — `sub-20-2d-1d-no-borrow`**
- **Описание**: вычитание однозначного из двузначного без перехода, в пределах 20.
- **Генератор**:
  - `a` 10..20, `b` 1..9
  - \((a%10) \ge b\)
  - ответ ≥0.

**SUB-A.003 — `sub-20-2d-1d-borrow`**
- **Описание**: вычитание однозначного из двузначного с переходом, в пределах 20.
- **Генератор**:
  - `a` 10..20, `b` 1..9
  - \((a%10) < b\)
  - ответ ≥0.

**SUB-A.004 — `sub-2d-2d-round`**
- **Описание**: двузначное − двузначное “круглое” (десятки), например 80−30.
- **Генератор**:
  - `a` ∈ {20,30,...,90}, `b` ∈ {10,20,...,a-10}
  - ответ кратен 10.

**SUB-A.005 — `sub-2d-2d-no-borrow`**
- **Описание**: двузначное − двузначное без перехода.
- **Генератор**:
  - `a` 10..99, `b` 10..a
  - \((a%10) \ge (b%10)\)
  - \(\lfloor a/10\rfloor \ge \lfloor b/10\rfloor\)

**SUB-A.006 — `sub-2d-2d-borrow`**
- **Описание**: двузначное − двузначное с переходом.
- **Генератор**:
  - `a` 10..99, `b` 10..a
  - \((a%10) < (b%10)\)
  - (опционально) ограничить, чтобы результат оставался двузначным (по договорённости).

---

### Epic SUB-EQU — Вычитание: неизвестный компонент (Type B)

**SUB-EQU.001 — `sub-missing-minuend-10`**
- **Формат**: `? − b = diff`
- **Диапазон**: ответ ≤10 (и `?` ≤10).
- **Генератор**:
  - выбрать `b` 1..9, `diff` 0..(10-b)
  - `answer = diff + b` (это “уменьшаемое”)

**SUB-EQU.002 — `sub-missing-subtrahend-10`**
- **Формат**: `a − ? = diff`
- **Диапазон**: `a` ≤10.
- **Генератор**:
  - выбрать `a` 1..10, `diff` 0..(a-1)
  - `answer = a - diff` (это “вычитаемое”)

**SUB-EQU.003 — `sub-missing-minuend-20`**
**SUB-EQU.004 — `sub-missing-subtrahend-20`**
**SUB-EQU.005 — `sub-missing-minuend-50`**
**SUB-EQU.006 — `sub-missing-subtrahend-50`**
**SUB-EQU.007 — `sub-missing-minuend-100`**
**SUB-EQU.008 — `sub-missing-subtrahend-100`**
- **Описание**: то же самое, но с увеличением диапазона `?`/`a`/`diff` до соответствующего предела.
- **Acceptance**:
  - всегда корректные неотрицательные значения
  - `answer` в пределах заданного лимита

## 6) Общие требования (для всех новых тренажёров)

- **Единый пайплайн**: вход → выбор уровня → сессия → результат (`TrainerFlow`).
- **FE↔BE**: все запросы через `/api/*`, на фронте `credentials: 'include'`.
- **Прогресс**: server-side прогресс (у нас уже есть `/api/progress/record` и хранение в БД).
- **Качество генерации**:
  - без “невозможных” примеров (отрицательные, выход за диапазон)
  - контролируемая сложность (carry/borrow строго по тренажёру)

## 7) Резюме “что будет сделано”

1) Обновим каталог упражнений 2 класса (порядок/секции).  
2) Добавим набор новых `exerciseId` для сложения/вычитания (Type A) в `MENTAL_MATH_CONFIGS`.  
3) Добавим новый “Equation drill” session (Type B) и заведём тренажёры “неизвестный компонент” для 10/20/50/100.  

